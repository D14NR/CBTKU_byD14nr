<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CBT PRO - Ujian Online Modern</title>
    
    <!-- Assets -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    
    <style>
        :root { 
            --primary-red: #dc2626; 
            --primary-red-hover: #b91c1c;
            --primary-red-light: #fee2e2;
            --white: #ffffff;
            --light-bg: #f9fafb;
            --dark-text: #111827;
            --muted-text: #6b7280;
            --border-color: #e5e7eb;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --info-blue: #3b82f6;
            --gradient-red: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--light-bg); 
            color: var(--dark-text);
            user-select: none; 
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-red);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-red-hover);
        }
        
        /* AUTH SCREEN */
        .auth-container { 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: var(--gradient-red);
            position: relative;
            overflow: hidden;
        }
        
        .auth-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }
        
        .auth-card { 
            background: var(--white); 
            width: 100%; 
            max-width: 1000px; 
            border-radius: 30px; 
            box-shadow: var(--shadow-xl); 
            overflow: hidden;
            position: relative;
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .auth-left {
            background: linear-gradient(135deg, rgba(220,38,38,0.9) 0%, rgba(153,27,27,0.9) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .auth-left::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
        }
        
        /* Enhanced Buttons */
        .btn-modern {
            border-radius: 15px;
            font-weight: 600;
            padding: 12px 30px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-modern:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary-custom {
            background: var(--gradient-red);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(220,38,38,0.3);
        }
        
        .btn-primary-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(220,38,38,0.4);
        }
        
        /* Dashboard Cards */
        .dashboard-card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-red);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .dashboard-card:hover::before {
            transform: scaleX(1);
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }
        
        .stat-card {
            background: var(--gradient-red);
            color: var(--white);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 15s infinite ease-in-out;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 10px;
        }
        
        /* Progress Bar */
        .progress-modern {
            height: 10px;
            border-radius: 10px;
            background: var(--border-color);
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar-modern {
            background: var(--gradient-red);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            animation: progressAnimation 2s ease-out;
        }
        
        @keyframes progressAnimation {
            from { width: 0; }
        }
        
        .progress-bar-modern::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* UJIAN SCREEN */
        .ujian-header {
            background: var(--white);
            border-bottom: 2px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            box-shadow: var(--shadow-md);
        }
        
        .timer-modern {
            background: var(--gradient-red);
            color: var(--white);
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(220,38,38,0.3);
            animation: timerPulse 2s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-warning {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: timerWarning 1s ease-in-out infinite;
        }
        
        @keyframes timerWarning {
            0%, 100% { box-shadow: 0 4px 15px rgba(239,68,68,0.5); }
            50% { box-shadow: 0 4px 30px rgba(239,68,68,0.8); }
        }
        
        /* Question Card */
        .question-card {
            background: var(--white);
            border-radius: 25px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-red);
        }
        
        .question-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: var(--gradient-red);
            color: var(--white);
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        /* Options */
        .option-modern {
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .option-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-red-light);
            transition: left 0.3s ease;
            z-index: 0;
        }
        
        .option-modern:hover::before {
            left: 0;
        }
        
        .option-modern:hover {
            transform: translateX(10px);
            border-color: var(--primary-red);
            box-shadow: var(--shadow-md);
        }
        
        .option-modern.selected {
            background: var(--primary-red-light);
            border-color: var(--primary-red);
            transform: scale(1.02);
        }
        
        .option-modern.selected::after {
            content: '‚úì';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            background: var(--primary-red);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: checkmark 0.3s ease;
        }
        
        @keyframes checkmark {
            0% { transform: translateY(-50%) scale(0); }
            50% { transform: translateY(-50%) scale(1.2); }
            100% { transform: translateY(-50%) scale(1); }
        }
        
        .option-label {
            width: 45px;
            height: 45px;
            background: var(--border-color);
            color: var(--dark-text);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .option-modern:hover .option-label {
            background: var(--primary-red);
            color: var(--white);
            transform: rotate(360deg);
        }
        
        .option-modern.selected .option-label {
            background: var(--primary-red);
            color: var(--white);
        }
        
        .option-text {
            position: relative;
            z-index: 1;
            flex-grow: 1;
        }
        
        /* Navigation Grid */
        .nav-grid-modern {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            padding: 20px;
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow-md);
        }
        
        .nav-item-modern {
            aspect-ratio: 1;
            border: 2px solid var(--border-color);
            background: var(--white);
            border-radius: 12px;
            font-weight: 600;
            color: var(--muted-text);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .nav-item-modern::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary-red-light);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        
        .nav-item-modern:hover::before {
            width: 100%;
            height: 100%;
        }
        
        .nav-item-modern:hover {
            transform: scale(1.1);
            border-color: var(--primary-red);
            color: var(--primary-red);
            box-shadow: var(--shadow-md);
        }
        
        .nav-item-modern.active {
            background: var(--gradient-red);
            color: var(--white);
            border-color: var(--primary-red);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(220,38,38,0.4);
        }
        
        .nav-item-modern.filled {
            background: var(--success-green);
            color: var(--white);
            border-color: var(--success-green);
        }
        
        .nav-item-modern.ragu {
            background: var(--warning-orange);
            color: var(--white);
            border-color: var(--warning-orange);
        }
        
        /* Floating Action Button */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        
        .fab-main {
            width: 60px;
            height: 60px;
            background: var(--gradient-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(220,38,38,0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fab-main:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 30px rgba(220,38,38,0.6);
        }
        
        /* Study Materials */
        .study-card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid var(--primary-red);
        }
        
        .study-card:hover {
            transform: translateX(10px);
            box-shadow: var(--shadow-lg);
        }
        
        .study-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-red-light);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-red);
            margin-bottom: 15px;
        }
        
        /* Performance Chart */
        .chart-container {
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }
        
        .chart-bar {
            height: 30px;
            background: var(--border-color);
            border-radius: 15px;
            margin-bottom: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .chart-fill {
            height: 100%;
            background: var(--gradient-red);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: var(--white);
            font-weight: 600;
            animation: chartGrow 1s ease-out;
        }
        
        @keyframes chartGrow {
            from { width: 0; }
        }
        
        /* Notifications */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-success {
            background: var(--success-green);
            color: var(--white);
        }
        
        .notification-error {
            background: var(--primary-red);
            color: var(--white);
        }
        
        .notification-info {
            background: var(--info-blue);
            color: var(--white);
        }
        
        /* Voice Assistant */
        .voice-assistant {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
        }
        
        .voice-btn {
            width: 50px;
            height: 50px;
            background: var(--gradient-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }
        
        .voice-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(220,38,38,0.6);
        }
        
        .voice-btn.listening {
            animation: voicePulse 1s ease-in-out infinite;
        }
        
        @keyframes voicePulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(220,38,38,0.7);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(220,38,38,0);
            }
        }
        
        /* Zoom Controls */
        .zoom-controls {
            position: fixed;
            top: 100px;
            right: 30px;
            background: var(--white);
            border-radius: 15px;
            padding: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .zoom-btn:hover {
            background: var(--primary-red-light);
            border-color: var(--primary-red);
            color: var(--primary-red);
        }
        
        /* Review Mode */
        .review-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--warning-orange);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Loading Screen */
        .loader-enhanced {
            width: 60px;
            height: 60px;
            border: 5px solid var(--border-color);
            border-top-color: var(--primary-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            position: relative;
        }
        
        .loader-enhanced::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 5px solid var(--border-color);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 0.5s linear infinite reverse;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .auth-card {
                border-radius: 0;
                max-width: 100%;
                height: 100vh;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .nav-grid-modern {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            }
            
            .zoom-controls {
                top: auto;
                bottom: 100px;
                right: 20px;
                flex-direction: row;
            }
            
            .voice-assistant {
                bottom: 20px;
                left: 20px;
            }
        }
        
        /* Dark Mode Support */
        body.dark-mode {
            --light-bg: #1a1a1a;
            --dark-text: #ffffff;
            --white: #2d2d2d;
            --border-color: #404040;
            --muted-text: #a0a0a0;
        }
        
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }
        
        .theme-switch {
            width: 60px;
            height: 30px;
            background: var(--border-color);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .theme-switch::after {
            content: 'üåô';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }
        
        body.dark-mode .theme-switch {
            background: var(--primary-red);
        }
        
        body.dark-mode .theme-switch::after {
            content: '‚òÄÔ∏è';
            transform: translateX(30px);
        }
        
        /* Micro-interactions */
        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .glow {
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(220,38,38,0.5); }
            50% { box-shadow: 0 0 20px rgba(220,38,38,0.8); }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    
    <!-- Dark Mode Toggle -->
    <div class="dark-mode-toggle">
        <div class="theme-switch" onclick="toggleDarkMode()"></div>
    </div>
    
    <!-- LOADER -->
    <div id="loader" class="loader-overlay d-none">
        <div class="loader-enhanced mb-3"></div>
        <h6 class="fw-bold text-secondary" id="loaderText">Memuat Sistem...</h6>
    </div>
    
    <!-- NOTIFICATION CONTAINER -->
    <div id="notificationContainer"></div>
    
    <!-- AUTH SCREEN -->
    <div id="viewAuth" class="auth-container">
        <div class="auth-card row g-0 animate__animated animate__fadeIn">
            <div class="col-lg-5 auth-left d-none d-lg-flex flex-column align-items-center justify-content-center text-white p-5">
                <div class="text-center">
                    <i class="bi bi-mortarboard-fill display-1 mb-4"></i>
                    <h1 class="fw-bold mb-3">CBT PRO</h1>
                    <p class="mb-4">Sistem Ujian Online Modern & Terintegrasi</p>
                    <div class="mt-auto">
                        <div class="d-flex gap-3 justify-content-center mb-3">
                            <div class="text-center">
                                <i class="bi bi-people-fill fs-2"></i>
                                <p class="small mb-0">10,000+</p>
                                <p class="small">Peserta</p>
                            </div>
                            <div class="text-center">
                                <i class="bi bi-book-fill fs-2"></i>
                                <p class="small mb-0">50,000+</p>
                                <p class="small">Soal</p>
                            </div>
                            <div class="text-center">
                                <i class="bi bi-trophy-fill fs-2"></i>
                                <p class="small mb-0">99.9%</p>
                                <p class="small">Success</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 p-5 p-lg-5">
                <ul class="nav nav-pills nav-fill mb-4 bg-light rounded-pill p-1" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 rounded-pill active fw-bold" data-bs-toggle="pill" data-bs-target="#tabLogin" type="button">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Masuk
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 rounded-pill fw-bold" data-bs-toggle="pill" data-bs-target="#tabRegister" type="button" onclick="loadAgendaDropdown()">
                            <i class="bi bi-person-plus me-2"></i>Daftar
                        </button>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tabLogin">
                        <form onsubmit="Auth.login(event)" class="animate__animated animate__fadeIn">
                            <div class="form-floating mb-3 position-relative">
                                <input type="text" class="form-control rounded-4 border-2" id="loginUser" placeholder="User" required>
                                <label for="loginUser"><i class="bi bi-person me-2"></i>Username / No WA</label>
                            </div>
                            <div class="form-floating mb-4 position-relative">
                                <input type="password" class="form-control rounded-4 border-2" id="loginPass" placeholder="Pass" required>
                                <label for="loginPass"><i class="bi bi-lock me-2"></i>Password</label>
                                <button type="button" class="password-toggle" onclick="Ui.togglePassword('loginPass', this)">
                                    <i class="bi bi-eye-slash-fill fs-5"></i>
                                </button>
                            </div>
                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="rememberMe">
                                <label class="form-check-label" for="rememberMe">
                                    Ingat saya
                                </label>
                            </div>
                            <button class="btn btn-modern btn-primary-custom w-100 py-3" type="submit">
                                <i class="bi bi-box-arrow-in-right me-2"></i>MASUK SEKARANG
                            </button>
                            <div class="text-center mt-3">
                                <a href="#" class="text-danger text-decoration-none">Lupa password?</a>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="tabRegister">
                        <form onsubmit="Auth.register(event)" class="animate__animated animate__fadeIn">
                            <select id="regAgenda" class="form-select py-3 rounded-4 border-2 mb-3" required>
                                <option value="">Memuat Agenda...</option>
                            </select>
                            <div class="row g-2 mb-3">
                                <div class="col-12">
                                    <div class="form-floating">
                                        <input type="text" id="regNama" class="form-control rounded-4 border-2" placeholder="Nama Lengkap" required>
                                        <label for="regNama"><i class="bi bi-person me-2"></i>Nama Lengkap</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating">
                                        <select id="regJenjang" class="form-select py-3 rounded-4 border-2" required>
                                            <option value="">Jenjang</option>
                                            <option value="SD">SD</option>
                                            <option value="SMP">SMP</option>
                                            <option value="SMA">SMA</option>
                                        </select>
                                        <label for="regJenjang"><i class="bi bi-building me-2"></i>Jenjang</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating">
                                        <input type="text" id="regKelas" class="form-control rounded-4 border-2" placeholder="Kelas" required>
                                        <label for="regKelas"><i class="bi bi-house-door me-2"></i>Kelas</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" id="regSekolah" class="form-control rounded-4 border-2" placeholder="Asal Sekolah" required>
                                <label for="regSekolah"><i class="bi bi-building me-2"></i>Asal Sekolah</label>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <div class="form-floating">
                                        <input type="number" id="regWa" class="form-control rounded-4 border-2" placeholder="No WA" oninput="this.value=this.value.replace(/\D/g,'').replace(/^0|^62/,'')" required>
                                        <label for="regWa"><i class="bi bi-whatsapp me-2"></i>No WA</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating">
                                        <input type="number" id="regWaOrtu" class="form-control rounded-4 border-2" placeholder="No WA Ortu" required>
                                        <label for="regWaOrtu"><i class="bi bi-telephone me-2"></i>No WA Ortu</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-floating mb-4 position-relative">
                                <input type="password" class="form-control rounded-4 border-2" id="regPass" placeholder="Password" required>
                                <label for="regPass"><i class="bi bi-lock me-2"></i>Password</label>
                                <button type="button" class="password-toggle" onclick="Ui.togglePassword('regPass', this)">
                                    <i class="bi bi-eye-slash-fill fs-5"></i>
                                </button>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">
                                    Saya setuju dengan <a href="#" class="text-danger">syarat & ketentuan</a>
                                </label>
                            </div>
                            <button class="btn btn-modern btn-success w-100 py-3" type="submit">
                                <i class="bi bi-person-plus me-2"></i>DAFTAR AKUN
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- DASHBOARD -->
    <div id="viewDashboard" class="d-none animate__animated animate__fadeIn">
        <!-- Header -->
        <div class="bg-white border-bottom py-3 sticky-top shadow-sm z-3">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center gap-3">
                            <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center" style="width:50px;height:50px">
                                <i class="bi bi-person-fill fs-4"></i>
                            </div>
                            <div>
                                <h5 class="mb-0 fw-bold" id="dashNama">Peserta</h5>
                                <small class="text-muted" id="dashSekolah">Sekolah</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 text-md-end mt-3 mt-md-0">
                        <button class="btn btn-outline-danger btn-sm rounded-pill px-3 me-2" onclick="showNotifications()">
                            <i class="bi bi-bell"></i>
                            <span class="badge bg-danger ms-1">3</span>
                        </button>
                        <button class="btn btn-outline-danger btn-sm rounded-pill px-3" onclick="Auth.logout()">
                            <i class="bi bi-box-arrow-right"></i> Keluar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container py-4">
            <!-- Statistics Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="100">
                    <div class="stat-card">
                        <div class="stat-number" id="statTotal">0</div>
                        <p class="mb-0">Total Ujian</p>
                        <small>Selesai diikuti</small>
                    </div>
                </div>
                <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="200">
                    <div class="stat-card">
                        <div class="stat-number" id="statScore">0</div>
                        <p class="mb-0">Skor Rata-rata</p>
                        <small>Dari semua ujian</small>
                    </div>
                </div>
                <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="300">
                    <div class="stat-card">
                        <div class="stat-number" id="statTime">0</div>
                        <p class="mb-0">Jam Belajar</p>
                        <small>Bulan ini</small>
                    </div>
                </div>
                <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="400">
                    <div class="stat-card">
                        <div class="stat-number" id="statRank">#0</div>
                        <p class="mb-0">Peringkat</p>
                        <small>Nasional</small>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="row g-3 mb-4">
                <div class="col-md-6" data-aos="fade-right">
                    <div class="dashboard-card">
                        <h5 class="fw-bold mb-3">
                            <i class="bi bi-lightning-charge text-danger me-2"></i>Aksi Cepat
                        </h5>
                        <div class="d-grid gap-2">
                            <button class="btn btn-modern btn-outline-danger" onclick="showStudyMaterials()">
                                <i class="bi bi-book me-2"></i>Materi Pembelajaran
                            </button>
                            <button class="btn btn-modern btn-outline-danger" onclick="showPerformance()">
                                <i class="bi bi-graph-up me-2"></i>Lihat Performa
                            </button>
                            <button class="btn btn-modern btn-outline-danger" onclick="startPractice()">
                                <i class="bi bi-play-circle me-2"></i>Latihan Soal
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6" data-aos="fade-left">
                    <div class="dashboard-card">
                        <h5 class="fw-bold mb-3">
                            <i class="bi bi-trophy text-warning me-2"></i>Pencapaian
                        </h5>
                        <div class="progress-modern mb-3">
                            <div class="progress-bar-modern" style="width: 75%">
                                <span>Level 5</span>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between text-muted small">
                            <span>2,500 / 3,000 XP</span>
                            <span>75%</span>
                        </div>
                        <div class="mt-3">
                            <span class="badge bg-warning me-2"><i class="bi bi-star-fill"></i> Top Student</span>
                            <span class="badge bg-info"><i class="bi bi-fire"></i> 7 Hari Streak</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 1: AGENDA LIST -->
            <div id="secAgenda" data-aos="fade-up">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold">
                        <i class="bi bi-calendar-event text-danger me-2"></i>Agenda Ujian
                    </h4>
                    <button class="btn btn-sm btn-outline-danger" onclick="refreshAgenda()">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
                <div id="agendaListContainer" class="row g-3"></div>
            </div>
            
            <!-- SECTION 2: TOKEN INPUT -->
            <div id="secToken" class="d-none animate__animated animate__fadeInRight">
                <button class="btn btn-sm btn-light mb-3" onclick="Dashboard.backToAgenda()">
                    <i class="bi bi-arrow-left"></i> Kembali
                </button>
                <div class="card border-0 shadow-lg rounded-4 p-5 text-center mx-auto" style="max-width: 500px;">
                    <div class="mb-4">
                        <i class="bi bi-shield-lock display-1 text-danger"></i>
                    </div>
                    <h4 class="fw-bold text-danger mb-1" id="tokenAgendaName">Ujian</h4>
                    <p class="text-muted mb-4">Masukkan Token Ujian</p>
                    <div class="position-relative mb-4">
                        <input type="text" id="inputToken" class="form-control form-control-lg text-center fw-bold fs-1 rounded-4 text-uppercase border-3 border-danger" maxlength="5" placeholder="_ _ _ _ _" style="letter-spacing: 10px;">
                        <div class="position-absolute top-50 end-0 translate-middle-y me-3">
                            <i class="bi bi-key-fill text-danger fs-3"></i>
                        </div>
                    </div>
                    <button class="btn btn-modern btn-danger w-100 py-3" onclick="Dashboard.verifyToken()">
                        <i class="bi bi-shield-check me-2"></i>VERIFIKASI TOKEN
                    </button>
                </div>
            </div>
            
            <!-- SECTION 3: MAPEL LIST -->
            <div id="secMapel" class="d-none animate__animated animate__fadeInUp">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold">
                        <i class="bi bi-journal-bookmark text-danger me-2"></i>Mata Pelajaran
                    </h4>
                    <button class="btn btn-sm btn-light border" onclick="Dashboard.backToAgenda()">
                        <i class="bi bi-arrow-left"></i> Ganti Agenda
                    </button>
                </div>
                <div id="mapelListContainer" class="row g-3"></div>
            </div>
            
            <!-- Study Materials Section -->
            <div id="studySection" class="d-none">
                <h4 class="fw-bold mb-4">
                    <i class="bi bi-book text-danger me-2"></i>Materi Pembelajaran
                </h4>
                <div id="studyContainer" class="row g-3"></div>
            </div>
            
            <!-- Performance Section -->
            <div id="performanceSection" class="d-none">
                <h4 class="fw-bold mb-4">
                    <i class="bi bi-graph-up text-danger me-2"></i>Performa Anda
                </h4>
                <div class="chart-container">
                    <h5 class="mb-3">Nilai per Mata Pelajaran</h5>
                    <div id="performanceChart"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- UJIAN ENGINE -->
    <div id="viewUjian" class="d-none bg-light min-vh-100">
        <!-- Header -->
        <div class="ujian-header">
            <div class="container-fluid py-3">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <div class="d-flex align-items-center gap-3">
                            <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="toggleSidebar()">
                                <i class="bi bi-list"></i>
                            </button>
                            <div>
                                <h6 class="mb-0 fw-bold" id="ujianMapelName">Mapel</h6>
                                <small class="text-muted">Dilarang Refresh Halaman!</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div id="timerDisplay" class="timer-modern mx-auto" style="display: inline-flex;">
                            <i class="bi bi-clock-fill"></i>
                            <span>00:00:00</span>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="d-flex gap-2 justify-content-end">
                            <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="toggleReviewMode()">
                                <i class="bi bi-eye"></i> Review
                            </button>
                            <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="bookmarkQuestion()">
                                <i class="bi bi-bookmark"></i>
                            </button>
                            <button class="btn btn-sm btn-danger rounded-pill" onclick="Exam.finish(false)">
                                <i class="bi bi-check-circle"></i> Selesai
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container-fluid ujian-layout">
            <div class="row">
                <!-- Sidebar Navigation -->
                <div id="sidebarNav" class="col-lg-3 d-none d-lg-block">
                    <div class="card border-0 shadow-lg rounded-4 sticky-top" style="top: 100px;">
                        <div class="card-header bg-white border-0 pt-3">
                            <h6 class="fw-bold">
                                <i class="bi bi-grid-3x3-gap text-danger me-2"></i>Navigasi Soal
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between text-sm mb-2">
                                    <span>Progress</span>
                                    <span id="progressText">0/0</span>
                                </div>
                                <div class="progress-modern">
                                    <div id="progressBar" class="progress-bar-modern" style="width: 0%"></div>
                                </div>
                            </div>
                            <div id="navGridDesktop" class="nav-grid-modern"></div>
                            <div class="mt-3 p-3 bg-light rounded-3">
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="badge bg-light text-dark"><i class="bi bi-circle"></i> Belum</span>
                                    <span class="badge bg-success"><i class="bi bi-check-circle"></i> Terjawab</span>
                                    <span class="badge bg-warning"><i class="bi bi-question-circle"></i> Ragu</span>
                                    <span class="badge bg-info"><i class="bi bi-bookmark"></i> Mark</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Question Area -->
                <div class="col-lg-9">
                    <div id="reviewBadge" class="review-badge d-none">
                        <i class="bi bi-eye"></i>
                        <span>Mode Review</span>
                    </div>
                    <div id="soalContainer" class="question-card animate__animated animate__fadeIn"></div>
                    
                    <!-- Navigation Buttons -->
                    <div class="card border-0 shadow-lg rounded-4 mt-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-modern btn-outline-secondary rounded-pill" id="btnPrev" onclick="Exam.navSoal(-1)">
                                    <i class="bi bi-arrow-left"></i> Sebelumnya
                                </button>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="checkRagu" onchange="Exam.toggleRagu()">
                                    <label class="form-check-label fw-bold text-warning" for="checkRagu">
                                        <i class="bi bi-exclamation-triangle"></i> Ragu
                                    </label>
                                </div>
                                <button class="btn btn-modern btn-danger rounded-pill" id="btnNext" onclick="Exam.navSoal(1)">
                                    Selanjutnya <i class="bi bi-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Zoom Controls -->
    <div id="zoomControls" class="zoom-controls d-none">
        <button class="zoom-btn" onclick="zoomIn()">
            <i class="bi bi-zoom-in"></i>
        </button>
        <button class="zoom-btn" onclick="zoomOut()">
            <i class="bi bi-zoom-out"></i>
        </button>
        <button class="zoom-btn" onclick="resetZoom()">
            <i class="bi bi-aspect-ratio"></i>
        </button>
    </div>
    
    <!-- Voice Assistant -->
    <div id="voiceAssistant" class="voice-assistant d-none">
        <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceAssistant()">
            <i class="bi bi-mic-fill"></i>
        </button>
    </div>
    
    <!-- Floating Action Button -->
    <div id="fabContainer" class="fab-container d-none">
        <button class="fab-main" onclick="toggleFabMenu()">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div id="fabMenu" class="d-none">
            <button class="btn btn-danger rounded-circle mb-2" onclick="showCalculator()">
                <i class="bi bi-calculator"></i>
            </button>
            <button class="btn btn-danger rounded-circle mb-2" onclick="showNotes()">
                <i class="bi bi-sticky"></i>
            </button>
            <button class="btn btn-danger rounded-circle" onclick="reportIssue()">
                <i class="bi bi-bug"></i>
            </button>
        </div>
    </div>
    
    <!-- MODAL RULES -->
    <div class="modal fade" id="modalRules" data-bs-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content rounded-4 border-0">
                <div class="modal-header bg-danger text-white rounded-top-4">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-shield-check me-2"></i>Tata Tertib Ujian
                    </h5>
                </div>
                <div class="modal-body p-4">
                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                        <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
                        <div>
                            <strong>Perhatian!</strong> Waktu berjalan saat tombol mulai ditekan.
                        </div>
                    </div>
                    <ol class="list-group list-group-numbered list-group-flush mb-3">
                        <li class="list-group-item">
                            <i class="bi bi-x-circle text-danger me-2"></i>
                            Dilarang membuka tab lain atau aplikasi lain
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-eye text-danger me-2"></i>
                            Sistem mendeteksi jika Anda keluar (Anti-Cheat)
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-clock-history text-danger me-2"></i>
                            Jika terdeteksi keluar, hitungan mundur 30 detik akan dimulai untuk auto-submit
                        </li>
                    </ol>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="checkAgree">
                        <label class="form-check-label fw-bold" for="checkAgree">
                            Saya mengerti dan siap mengerjakan dengan jujur
                        </label>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger px-4 fw-bold" id="btnStartReal" disabled onclick="Exam.startReal()">
                        <i class="bi bi-play-circle me-2"></i>MULAI MENGERJAKAN
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL VIOLATION -->
    <div class="modal fade" id="modalViolation" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 rounded-4 shadow-lg">
                <div class="modal-body p-5 text-center">
                    <div class="text-danger mb-3">
                        <i class="bi bi-exclamation-octagon-fill display-1"></i>
                    </div>
                    <h3 class="fw-bold text-danger">PERINGATAN!</h3>
                    <p class="mb-4">Anda meninggalkan halaman ujian.<br>Ujian akan otomatis diselesaikan dalam:</p>
                    <h1 class="fw-bold mb-4 display-3 text-danger" id="violationTimer">30</h1>
                    <button id="btnResumeExam" class="btn btn-modern btn-outline-dark rounded-pill px-5 fw-bold me-2" onclick="Exam.resume()">
                        <i class="bi bi-play"></i> LANJUTKAN UJIAN
                    </button>
                    <button id="btnForceFinish" class="btn btn-modern btn-danger rounded-pill px-5 fw-bold d-none" onclick="Exam.finish(true)">
                        <i class="bi bi-stop-circle"></i> SELESAIKAN SEKARANG
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL KARTU -->
    <div class="modal fade" id="modalKartu">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4">
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <i class="bi bi-check-circle-fill text-success display-1"></i>
                    </div>
                    <h5 class="fw-bold text-success mb-3">Registrasi Berhasil!</h5>
                    <div id="kartuArea" class="border p-3 text-start bg-white mb-3 rounded-3">
                        <h6 class="text-center fw-bold border-bottom pb-2">
                            <i class="bi bi-card-text me-2"></i>KARTU PESERTA
                        </h6>
                        <table class="table table-sm table-borderless mb-0">
                            <tr>
                                <td width="30%"><i class="bi bi-person me-2"></i>Nama</td>
                                <td class="fw-bold" id="cardNama"></td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-person-badge me-2"></i>User</td>
                                <td class="fw-bold text-danger" id="cardUser"></td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-key me-2"></i>Pass</td>
                                <td class="fw-bold" id="cardPass"></td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-calendar me-2"></i>Agenda</td>
                                <td id="cardAgenda"></td>
                            </tr>
                        </table>
                    </div>
                    <button class="btn btn-modern btn-danger w-100 mb-2" onclick="downloadKartu()">
                        <i class="bi bi-download me-2"></i>Download Kartu
                    </button>
                    <button class="btn btn-modern btn-light w-100" onclick="tutupKartuKeLogin()">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login Sekarang
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true
        });
        
        // GLOBAL STATE
        const App = {
            state: { 
                user: null, 
                agendaId: null, 
                mapelList: [], 
                activeMapel: null, 
                tempMapelId: null, 
                soal: [], 
                jawaban: [], 
                ragu: [], 
                bookmarked: [],
                endTime: 0, 
                timer: null, 
                currentSoalIdx: 0, 
                dashInterval: null, 
                cheatTimer: 30, 
                cheatInterval: null, 
                selectedLeftIndex: null,
                reviewMode: false,
                zoomLevel: 1,
                voiceEnabled: false,
                darkMode: false
            },
            ui: { 
                load: (s,t='Memuat...')=>{ 
                    document.getElementById('loaderText').innerText=t; 
                    document.getElementById('loader').classList.toggle('d-none',!s); 
                },
                view: (id)=>{ 
                    ['viewAuth','viewDashboard','viewUjian'].forEach(v=>document.getElementById(v).classList.add('d-none')); 
                    document.getElementById(id).classList.remove('d-none'); 
                }
            },
            data: { 
                save:(k,v)=>localStorage.setItem(k,JSON.stringify(v)), 
                get:(k)=>JSON.parse(localStorage.getItem(k)), 
                remove:(k)=>localStorage.removeItem(k) 
            }
        };
        
        // UI HELPERS
        const Ui = {
            togglePassword: (inputId, button) => {
                const input = document.getElementById(inputId);
                const icon = button.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('bi-eye-slash-fill');
                    icon.classList.add('bi-eye-fill');
                } else {
                    input.type = 'password';
                    icon.classList.remove('bi-eye-fill');
                    icon.classList.add('bi-eye-slash-fill');
                }
            },
            showNotification: (message, type = 'info') => {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = 'notification-toast';
                
                const icons = {
                    success: 'bi-check-circle-fill',
                    error: 'bi-x-circle-fill',
                    info: 'bi-info-circle-fill',
                    warning: 'bi-exclamation-triangle-fill'
                };
                
                const bgColors = {
                    success: 'notification-success',
                    error: 'notification-error',
                    info: 'notification-info',
                    warning: 'notification-warning'
                };
                
                notification.innerHTML = `
                    <div class="notification-icon ${bgColors[type]}">
                        <i class="bi ${icons[type]}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                        <p class="mb-0 small">${message}</p>
                    </div>
                    <button class="btn-close ms-3" onclick="this.parentElement.remove()"></button>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease forwards';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }
        };
        
        // AUTH MODULE
        const Auth = {
            init: () => { 
                const u = App.data.get('cbt_user'); 
                if(u){ 
                    App.state.user = u; 
                    Dashboard.show(); 
                } else { 
                    App.ui.view('viewAuth'); 
                } 
            },
            login: (e) => { 
                e.preventDefault(); 
                App.ui.load(true,'Login...'); 
                
                // Simulate API call
                setTimeout(() => {
                    App.ui.load(false);
                    const user = {
                        id: 1,
                        nama_peserta: document.getElementById('loginUser').value,
                        asal_sekolah: 'SMA Negeri 1 Jakarta'
                    };
                    App.state.user = user;
                    App.data.save('cbt_user', user);
                    Ui.showNotification('Login berhasil!', 'success');
                    Dashboard.show();
                }, 1500);
            },
            register: (e) => { 
                e.preventDefault(); 
                App.ui.load(true,'Daftar...');
                
                // Simulate API call
                setTimeout(() => {
                    App.ui.load(false);
                    const f = {
                        agenda_id: document.getElementById('regAgenda').value,
                        nama: document.getElementById('regNama').value,
                        username: document.getElementById('regWa').value.replace(/\D/g,'').replace(/^0|^62/,''),
                        password: document.getElementById('regPass').value
                    };
                    
                    document.getElementById('cardNama').innerText = f.nama;
                    document.getElementById('cardUser').innerText = f.username;
                    document.getElementById('cardPass').innerText = f.password;
                    document.getElementById('cardAgenda').innerText = 'Ujian Nasional 2024';
                    
                    new bootstrap.Modal(document.getElementById('modalKartu')).show();
                    e.target.reset();
                    Ui.showNotification('Registrasi berhasil!', 'success');
                }, 1500);
            },
            loadAgendas: () => { 
                const s = document.getElementById('regAgenda'); 
                if(s.options.length > 1) return; 
                
                // Simulate API call
                setTimeout(() => {
                    const agendas = [
                        { id: 1, agenda_ujian: 'Ujian Nasional 2024' },
                        { id: 2, agenda_ujian: 'Ujian Sekolah 2024' },
                        { id: 3, agenda_ujian: 'Try Out UTBK 2024' }
                    ];
                    
                    agendas.forEach(a => {
                        s.innerHTML += `<option value="${a.id}">${a.agenda_ujian}</option>`;
                    });
                }, 1000);
            },
            logout: () => {
                Swal.fire({
                    icon: 'question', 
                    title: 'Keluar?', 
                    text: 'Apakah Anda yakin ingin keluar?', 
                    showCancelButton: true, 
                    confirmButtonColor: '#dc2626', 
                    cancelButtonColor: '#6b7280', 
                    confirmButtonText: 'Ya, Keluar'
                }).then((result) => { 
                    if(result.isConfirmed) { 
                        App.data.remove('cbt_user'); 
                        if (App.state.dashInterval) clearInterval(App.state.dashInterval);
                        if (App.state.timer) clearInterval(App.state.timer);
                        if (App.state.cheatInterval) clearInterval(App.state.cheatInterval);
                        App.state = { 
                            user: null, 
                            agendaId: null, 
                            mapelList: [], 
                            activeMapel: null, 
                            tempMapelId: null, 
                            soal: [], 
                            jawaban: [], 
                            ragu: [], 
                            bookmarked: [],
                            endTime: 0, 
                            timer: null, 
                            currentSoalIdx: 0, 
                            dashInterval: null, 
                            cheatTimer: 30, 
                            cheatInterval: null, 
                            selectedLeftIndex: null,
                            reviewMode: false,
                            zoomLevel: 1,
                            voiceEnabled: false,
                            darkMode: false
                        };
                        document.getElementById('loginUser').value = ''; 
                        document.getElementById('loginPass').value = '';
                        App.ui.view('viewAuth'); 
                        Ui.showNotification('Anda telah keluar', 'info');
                    }
                });
            }
        };
        
        // DASHBOARD MODULE
        const Dashboard = {
            show: () => {
                App.ui.view('viewDashboard'); 
                document.getElementById('dashNama').innerText = App.state.user.nama_peserta; 
                document.getElementById('dashSekolah').innerText = App.state.user.asal_sekolah;
                document.getElementById('secAgenda').classList.remove('d-none'); 
                document.getElementById('secToken').classList.add('d-none'); 
                document.getElementById('secMapel').classList.add('d-none');
                
                // Update statistics
                Dashboard.updateStats();
                
                const cont = document.getElementById('agendaListContainer'); 
                cont.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-danger"></div></div>';
                
                // Simulate API call
                setTimeout(() => {
                    cont.innerHTML = '';
                    const agendas = [
                        {
                            id: 1,
                            agenda_ujian: 'Ujian Nasional 2024',
                            tgljam_mulai: new Date(Date.now() + 3600000).toISOString(),
                            tgljam_selesai: new Date(Date.now() + 7200000).toISOString()
                        },
                        {
                            id: 2,
                            agenda_ujian: 'Ujian Sekolah 2024',
                            tgljam_mulai: new Date(Date.now() + 86400000).toISOString(),
                            tgljam_selesai: new Date(Date.now() + 90000000).toISOString()
                        }
                    ];
                    
                    if(App.state.dashInterval) clearInterval(App.state.dashInterval);
                    
                    agendas.forEach(a => {
                        cont.innerHTML += `
                        <div class="col-md-6 col-lg-4" data-aos="fade-up">
                            <div class="card h-100 dashboard-card p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="fw-bold">${a.agenda_ujian}</h5>
                                    <span class="badge bg-danger rounded-pill">
                                        <i class="bi bi-clock"></i> Live
                                    </span>
                                </div>
                                <div class="text-muted small mb-3">
                                    <i class="bi bi-calendar-event me-1"></i>
                                    Mulai: ${new Date(a.tgljam_mulai).toLocaleString()}
                                </div>
                                <div id="count-${a.id}" class="alert alert-light border text-center fw-bold mb-3">
                                    ...
                                </div>
                                <button id="btn-${a.id}" class="btn btn-modern btn-primary-custom w-100" onclick="Dashboard.openToken(${a.id}, '${a.agenda_ujian}')">
                                    <i class="bi bi-play-circle me-2"></i>BUKA UJIAN
                                </button>
                            </div>
                        </div>`;
                    });
                    
                    const update = () => {
                        const now = new Date().getTime();
                        agendas.forEach(a => {
                            const start = new Date(a.tgljam_mulai).getTime(), 
                                  end = new Date(a.tgljam_selesai).getTime();
                            const elC = document.getElementById(`count-${a.id}`), 
                                  elB = document.getElementById(`btn-${a.id}`);
                            if(!elC) return;
                            
                            if(now < start) {
                                elC.innerHTML = `<i class="bi bi-hourglass-split"></i> Dimulai dlm: ${Dashboard.fmt(start - now)}`; 
                                elC.className = 'alert alert-warning border text-center fw-bold mb-3';
                                elB.disabled = true; 
                                elB.className = 'btn btn-modern btn-secondary w-100';
                            } else if(now >= start && now <= end) {
                                elC.innerHTML = `<i class="bi bi-clock-fill"></i> Sisa Waktu: ${Dashboard.fmt(end - now)}`; 
                                elC.className = 'alert alert-success border text-center fw-bold mb-3';
                                elB.disabled = false; 
                                elB.className = 'btn btn-modern btn-primary-custom w-100';
                            } else {
                                elC.innerHTML = '<i class="bi bi-x-circle"></i> BERAKHIR'; 
                                elC.className = 'alert alert-danger border text-center fw-bold mb-3';
                                elB.disabled = true; 
                                elB.className = 'btn btn-modern btn-secondary w-100';
                            }
                        });
                    };
                    update(); 
                    App.state.dashInterval = setInterval(update, 1000);
                }, 1500);
            },
            updateStats: () => {
                // Animate statistics
                const animateValue = (id, start, end, duration) => {
                    const obj = document.getElementById(id);
                    const range = end - start;
                    const minTimer = 50;
                    let stepTime = Math.abs(Math.floor(duration / range));
                    stepTime = Math.max(stepTime, minTimer);
                    const startTime = new Date().getTime();
                    const endTime = startTime + duration;
                    let timer;
                    
                    function run() {
                        const now = new Date().getTime();
                        const remaining = Math.max((endTime - now) / duration, 0);
                        const value = Math.round(end - (remaining * range));
                        obj.innerHTML = value;
                        if (value == end) {
                            clearInterval(timer);
                        }
                    }
                    
                    timer = setInterval(run, stepTime);
                    run();
                };
                
                animateValue("statTotal", 0, 12, 2000);
                animateValue("statScore", 0, 85, 2000);
                animateValue("statTime", 0, 48, 2000);
                document.getElementById("statRank").innerHTML = "#42";
            },
            fmt: (ms) => {
                const d = Math.floor(ms/86400000), 
                      h = Math.floor((ms%86400000)/3600000), 
                      m = Math.floor((ms%3600000)/60000), 
                      s = Math.floor((ms%60000)/1000);
                return (d>0?d+'h ':'') + h + 'j ' + m + 'm ' + s + 'd';
            },
            openToken: (id, name) => { 
                App.state.agendaId = id; 
                document.getElementById('secAgenda').classList.add('d-none'); 
                document.getElementById('secToken').classList.remove('d-none'); 
                document.getElementById('tokenAgendaName').innerText = name; 
                document.getElementById('inputToken').value=''; 
            },
            backToAgenda: () => { 
                document.getElementById('secToken').classList.add('d-none'); 
                document.getElementById('secMapel').classList.add('d-none'); 
                document.getElementById('studySection').classList.add('d-none');
                document.getElementById('performanceSection').classList.add('d-none');
                document.getElementById('secAgenda').classList.remove('d-none'); 
            },
            verifyToken: () => {
                const t = document.getElementById('inputToken').value.trim(); 
                if(!t) return;
                
                App.ui.load(true); 
                
                // Simulate API call
                setTimeout(() => {
                    if(t.toUpperCase() === 'DEMO') {
                        Dashboard.refreshMapel();
                    } else {
                        App.ui.load(false); 
                        Swal.fire({
                            icon: 'error', 
                            title: 'Gagal', 
                            text: 'Token salah! Gunakan token "DEMO"', 
                            confirmButtonColor: '#dc2626'
                        }); 
                    }
                }, 1500);
            },
            refreshMapel: () => {
                App.ui.view('viewDashboard');
                
                // Simulate API call
                setTimeout(() => {
                    const mapels = [
                        { id: 1, nama_mata_pelajaran: 'Matematika', jumlah_soal: 40, durasi_ujian: 120, status_kerjakan: 'Belum' },
                        { id: 2, nama_mata_pelajaran: 'Bahasa Indonesia', jumlah_soal: 50, durasi_ujian: 120, status_kerjakan: 'Selesai' },
                        { id: 3, nama_mata_pelajaran: 'Bahasa Inggris', jumlah_soal: 45, durasi_ujian: 90, status_kerjakan: 'Proses' },
                        { id: 4, nama_mata_pelajaran: 'Fisika', jumlah_soal: 35, durasi_ujian: 90, status_kerjakan: 'Belum' }
                    ];
                    
                    App.state.mapelList = mapels;
                    Dashboard.showMapel();
                }, 1000);
            },
            showMapel: () => {
                document.getElementById('secToken').classList.add('d-none'); 
                document.getElementById('secMapel').classList.remove('d-none');
                
                const cont = document.getElementById('mapelListContainer'); 
                cont.innerHTML = '';
                
                App.state.mapelList.forEach((m, index) => {
                    let status = m.status_kerjakan; 
                    if(status) status = status.trim(); 
                    let btn = ''; 
                    let cardClass = '';
                    let icon = '';
                    
                    if(status === 'Selesai') {
                        btn = `<button class="btn btn-modern btn-secondary w-100" disabled>
                            <i class="bi bi-check-circle-fill"></i> SELESAI
                        </button>`;
                        cardClass = 'bg-light border-success';
                        icon = '<i class="bi bi-check-circle-fill text-success fs-3"></i>';
                    } else if(status === 'Proses' || status === 'Lanjut') {
                        btn = `<button class="btn btn-modern btn-warning text-white w-100" onclick="Exam.confirm(${m.id})">
                            <i class="bi bi-play-fill"></i> LANJUTKAN
                        </button>`;
                        cardClass = 'border-warning';
                        icon = '<i class="bi bi-clock-fill text-warning fs-3"></i>';
                    } else {
                        btn = `<button class="btn btn-modern btn-primary-custom w-100" onclick="Exam.confirm(${m.id})">
                            <i class="bi bi-play-circle"></i> MULAI
                        </button>`;
                        icon = '<i class="bi bi-play-circle text-danger fs-3"></i>';
                    }
                    
                    cont.innerHTML += `
                    <div class="col-md-6" data-aos="fade-up" data-aos-delay="${index * 100}">
                        <div class="card shadow-sm rounded-4 p-4 h-100 ${cardClass}">
                            <div class="d-flex align-items-start gap-3">
                                <div class="flex-shrink-0">
                                    ${icon}
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="fw-bold mb-2">${m.nama_mata_pelajaran}</h6>
                                    <div class="text-muted small mb-3">
                                        <div class="d-flex gap-3">
                                            <span><i class="bi bi-clock"></i> ${m.durasi_ujian} Menit</span>
                                            <span><i class="bi bi-file-text"></i> ${m.jumlah_soal} Soal</span>
                                        </div>
                                    </div>
                                    ${btn}
                                </div>
                            </div>
                        </div>
                    </div>`;
                });
            }
        };
        
        // EXAM MODULE
        const Exam = {
            confirm: (mid) => {
                App.state.tempMapelId = mid;
                document.getElementById('checkAgree').checked = false; 
                document.getElementById('btnStartReal').disabled = true;
                new bootstrap.Modal(document.getElementById('modalRules')).show();
                document.getElementById('checkAgree').onchange = (e) => document.getElementById('btnStartReal').disabled = !e.target.checked;
            },
            
            startReal: () => {
                bootstrap.Modal.getInstance(document.getElementById('modalRules')).hide();
                App.ui.load(true, 'Menyiapkan Soal...');
                
                // Simulate API call
                setTimeout(() => {
                    const soalData = [];
                    for(let i = 1; i <= 5; i++) {
                        soalData.push({
                            id: i,
                            pertanyaan: `Ini adalah contoh soal nomor ${i}. Pilih jawaban yang paling benar!`,
                            type_soal: 'Pilihan Ganda',
                            pilihan_a: `Pilihan A untuk soal ${i}`,
                            pilihan_b: `Pilihan B untuk soal ${i}`,
                            pilihan_c: `Pilihan C untuk soal ${i}`,
                            pilihan_d: `Pilihan D untuk soal ${i}`,
                            pilihan_e: `Pilihan E untuk soal ${i}`
                        });
                    }
                    
                    App.state.soal = soalData;
                    App.state.activeMapel = { id: 1, nama_mata_pelajaran: 'Matematika', durasi_ujian: 120 };
                    App.state.jawaban = Array(soalData.length).fill('-');
                    App.state.ragu = Array(soalData.length).fill(false);
                    App.state.bookmarked = Array(soalData.length).fill(false);
                    App.state.endTime = new Date().getTime() + (120 * 60000);
                    
                    App.ui.view('viewUjian');
                    document.getElementById('zoomControls').classList.remove('d-none');
                    document.getElementById('voiceAssistant').classList.remove('d-none');
                    document.getElementById('fabContainer').classList.remove('d-none');
                    
                    App.state.currentSoalIdx = 0;
                    Exam.renderSoal();
                    Exam.timer();
                    Exam.antiCheat();
                    App.ui.load(false);
                    Ui.showNotification('Ujian dimulai!', 'success');
                }, 2000);
            },
            
            renderSoal: () => {
                const s = App.state.soal[App.state.currentSoalIdx];
                const j = App.state.jawaban[App.state.currentSoalIdx]; 
                
                document.getElementById('ujianMapelName').innerHTML = `
                    <i class="bi bi-journal-bookmark me-2"></i>${App.state.activeMapel.nama_mata_pelajaran}
                `;
                document.getElementById('checkRagu').checked = App.state.ragu[App.state.currentSoalIdx];
                
                // Update progress
                const answered = App.state.jawaban.filter(a => a !== '-').length;
                const total = App.state.soal.length;
                document.getElementById('progressText').innerText = `${answered}/${total}`;
                document.getElementById('progressBar').style.width = `${(answered/total) * 100}%`;
                
                let h = `
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <span class="question-number">${App.state.currentSoalIdx + 1}</span>
                            <span class="badge bg-light text-dark border ms-3">${s.type_soal}</span>
                        </div>
                        <div>
                            ${App.state.bookmarked[App.state.currentSoalIdx] ? 
                                '<span class="badge bg-info"><i class="bi bi-bookmark-fill"></i> Ditandai</span>' : ''}
                            ${App.state.reviewMode ? 
                                '<span class="badge bg-warning"><i class="bi bi-eye"></i> Review Mode</span>' : ''}
                        </div>
                    </div>
                `;
                
                h += `<div class="fs-5 mb-4 lh-base">${s.pertanyaan}</div>`;
                
                // Render options
                ['a','b','c','d','e'].forEach(o => {
                    const txt = s[`pilihan_${o}`];
                    if(txt && txt !== "") {
                        const sel = j === o.toUpperCase() ? 'selected' : '';
                        h += `
                        <div class="option-modern ${sel}" onclick="Exam.ansPGSingle('${o.toUpperCase()}')">
                            <div class="option-label">${o.toUpperCase()}</div>
                            <div class="option-text">${txt}</div>
                        </div>`;
                    }
                });
                
                document.getElementById('soalContainer').innerHTML = h;
                Exam.navUpdate();
            },
            
            ansPGSingle: (val) => { 
                Exam.saveAnswer(val); 
                Exam.renderSoal();
            },
            
            saveAnswer: (val) => {
                App.state.jawaban[App.state.currentSoalIdx] = val || '-';
                App.data.save(`ans_${App.state.activeMapel.id}`, App.state.jawaban);
                Exam.navUpdate();
            },
            
            toggleRagu: () => { 
                App.state.ragu[App.state.currentSoalIdx] = document.getElementById('checkRagu').checked; 
                Exam.navUpdate(); 
            },
            
            navSoal: (d) => { 
                App.state.currentSoalIdx += d; 
                if(App.state.currentSoalIdx < 0) App.state.currentSoalIdx = 0;
                if(App.state.currentSoalIdx >= App.state.soal.length) {
                    Exam.finish(false);
                    return;
                }
                Exam.renderSoal(); 
            },
            
            navUpdate: () => {
                document.getElementById('btnPrev').disabled = App.state.currentSoalIdx === 0;
                const bn = document.getElementById('btnNext');
                if(App.state.currentSoalIdx === App.state.soal.length - 1) { 
                    bn.innerHTML = '<i class="bi bi-check-circle me-2"></i>SELESAI'; 
                    bn.className = 'btn btn-modern btn-danger rounded-pill'; 
                } else { 
                    bn.innerHTML = 'Selanjutnya <i class="bi bi-arrow-right"></i>'; 
                    bn.className = 'btn btn-modern btn-danger rounded-pill'; 
                }
                
                const g = document.getElementById('navGridDesktop'); 
                g.innerHTML = '';
                App.state.soal.forEach((_, i) => {
                    let c = ''; 
                    if(i === App.state.currentSoalIdx) c='active'; 
                    else if(App.state.ragu[i]) c='ragu'; 
                    else if(App.state.bookmarked[i]) c='bg-info text-white'; 
                    else if(App.state.jawaban[i] !== '-') c='filled';
                    g.innerHTML += `<button class="nav-item-modern ${c}" onclick="App.state.currentSoalIdx=${i};Exam.renderSoal()">${i+1}</button>`;
                });
            },
            
            timer: () => {
                if(App.state.timer) clearInterval(App.state.timer);
                App.state.timer = setInterval(() => {
                    const diff = App.state.endTime - Date.now();
                    if(diff < 0) { 
                        clearInterval(App.state.timer); 
                        Exam.finish(true); 
                        return; 
                    }
                    const h = Math.floor(diff/3600000), 
                          m = Math.floor((diff%3600000)/60000), 
                          s = Math.floor((diff%60000)/1000);
                    const timerEl = document.getElementById('timerDisplay');
                    timerEl.innerHTML = `<i class="bi bi-clock-fill"></i><span>${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}</span>`;
                    if(diff < 300000) timerEl.classList.add('timer-warning');
                }, 1000);
            },
            
            antiCheat: () => {
                document.addEventListener('visibilitychange', () => {
                    if(document.hidden && !document.getElementById('viewUjian').classList.contains('d-none')) {
                        new bootstrap.Modal(document.getElementById('modalViolation')).show();
                        App.state.cheatTimer = 30; 
                        document.getElementById('violationTimer').innerText = 30;
                        document.getElementById('btnResumeExam').classList.remove('d-none'); 
                        document.getElementById('btnForceFinish').classList.add('d-none');
                        if(App.state.cheatInterval) clearInterval(App.state.cheatInterval);
                        App.state.cheatInterval = setInterval(() => {
                            App.state.cheatTimer--; 
                            document.getElementById('violationTimer').innerText = App.state.cheatTimer;
                            if(App.state.cheatTimer <= 0) {
                                clearInterval(App.state.cheatInterval); 
                                document.getElementById('violationTimer').innerText = "WAKTU HABIS";
                                document.getElementById('btnResumeExam').classList.add('d-none'); 
                                document.getElementById('btnForceFinish').classList.remove('d-none');
                                document.getElementById('btnForceFinish').onclick = () => Exam.finish(true);
                            }
                        }, 1000);
                    }
                });
            },
            
            resume: () => { 
                clearInterval(App.state.cheatInterval); 
                bootstrap.Modal.getInstance(document.getElementById('modalViolation')).hide(); 
            },
            
            finish: (force) => {
                if(!force && !confirm('Yakin ingin menyelesaikan ujian?')) return;
                App.ui.load(true, 'Menyimpan...'); 
                clearInterval(App.state.timer); 
                clearInterval(App.state.cheatInterval);
                const str = App.state.jawaban.map(j=>j||'-').join('|');
                
                // Simulate API call
                setTimeout(() => {
                    App.ui.load(false);
                    const vModal = bootstrap.Modal.getInstance(document.getElementById('modalViolation')); 
                    if(vModal) vModal.hide();
                    
                    Swal.fire({
                        icon: 'success', 
                        title: 'Selesai!', 
                        text: 'Ujian telah selesai dan disimpan.', 
                        confirmButtonColor: '#10b981'
                    }).then(() => {
                        document.getElementById('zoomControls').classList.add('d-none');
                        document.getElementById('voiceAssistant').classList.add('d-none');
                        document.getElementById('fabContainer').classList.add('d-none');
                        Dashboard.refreshMapel();
                    });
                }, 1500);
            }
        };
        
        // Additional Functions
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            App.state.darkMode = !App.state.darkMode;
            App.data.save('darkMode', App.state.darkMode);
            Ui.showNotification(`Mode ${App.state.darkMode ? 'gelap' : 'terang'} diaktifkan`, 'info');
        }
        
        function toggleSidebar() {
            document.getElementById('sidebarNav').classList.toggle('d-none');
        }
        
        function toggleReviewMode() {
            App.state.reviewMode = !App.state.reviewMode;
            document.getElementById('reviewBadge').classList.toggle('d-none');
            Exam.renderSoal();
            Ui.showNotification(`Mode review ${App.state.reviewMode ? 'diaktifkan' : 'dinonaktifkan'}`, 'info');
        }
        
        function bookmarkQuestion() {
            App.state.bookmarked[App.state.currentSoalIdx] = !App.state.bookmarked[App.state.currentSoalIdx];
            Exam.renderSoal();
            Ui.showNotification(`Soal ${App.state.bookmarked[App.state.currentSoalIdx] ? 'ditandai' : 'hapus tanda'}`, 'info');
        }
        
        function zoomIn() {
            App.state.zoomLevel = Math.min(App.state.zoomLevel + 0.1, 2);
            document.getElementById('soalContainer').style.transform = `scale(${App.state.zoomLevel})`;
            Ui.showNotification(`Zoom: ${Math.round(App.state.zoomLevel * 100)}%`, 'info');
        }
        
        function zoomOut() {
            App.state.zoomLevel = Math.max(App.state.zoomLevel - 0.1, 0.5);
            document.getElementById('soalContainer').style.transform = `scale(${App.state.zoomLevel})`;
            Ui.showNotification(`Zoom: ${Math.round(App.state.zoomLevel * 100)}%`, 'info');
        }
        
        function resetZoom() {
            App.state.zoomLevel = 1;
            document.getElementById('soalContainer').style.transform = `scale(1)`;
            Ui.showNotification('Zoom direset', 'info');
        }
        
        function toggleVoiceAssistant() {
            const btn = document.getElementById('voiceBtn');
            App.state.voiceEnabled = !App.state.voiceEnabled;
            
            if(App.state.voiceEnabled) {
                btn.classList.add('listening');
                Ui.showNotification('Asisten suara diaktifkan', 'success');
                // Start voice recognition here
            } else {
                btn.classList.remove('listening');
                Ui.showNotification('Asisten suara dinonaktifkan', 'info');
            }
        }
        
        function toggleFabMenu() {
            document.getElementById('fabMenu').classList.toggle('d-none');
        }
        
        function showCalculator() {
            Swal.fire({
                title: 'Kalkulator',
                html: '<input type="text" id="calc-input" class="form-control text-center fs-3" readonly>',
                showConfirmButton: false,
                showCloseButton: true,
                didOpen: () => {
                    // Simple calculator implementation
                }
            });
        }
        
        function showNotes() {
            Swal.fire({
                title: 'Catatan',
                input: 'textarea',
                inputPlaceholder: 'Tulis catatan Anda di sini...',
                showConfirmButton: true,
                confirmButtonText: 'Simpan'
            });
        }
        
        function reportIssue() {
            Swal.fire({
                title: 'Laporkan Masalah',
                input: 'textarea',
                inputPlaceholder: 'Jelaskan masalah yang Anda temui...',
                showConfirmButton: true,
                confirmButtonText: 'Kirim Laporan'
            });
        }
        
        function showStudyMaterials() {
            document.getElementById('secAgenda').classList.add('d-none');
            document.getElementById('studySection').classList.remove('d-none');
            
            const container = document.getElementById('studyContainer');
            container.innerHTML = '';
            
            const materials = [
                { title: 'Video Pembelajaran', icon: 'bi-play-circle', desc: 'Kumpulan video materi pembelajaran' },
                { title: 'E-Book', icon: 'bi-book', desc: 'Buku elektronik lengkap' },
                { title: 'Latihan Soal', icon: 'bi-pencil-square', desc: 'Bank soal untuk berlatih' },
                { title: 'Simulasi Ujian', icon: 'bi-laptop', desc: 'Simulasi ujian sesungguhnya' }
            ];
            
            materials.forEach((m, i) => {
                container.innerHTML += `
                    <div class="col-md-6" data-aos="fade-up" data-aos-delay="${i * 100}">
                        <div class="study-card">
                            <div class="study-icon">
                                <i class="bi ${m.icon}"></i>
                            </div>
                            <h6 class="fw-bold">${m.title}</h6>
                            <p class="text-muted small mb-0">${m.desc}</p>
                        </div>
                    </div>
                `;
            });
        }
        
        function showPerformance() {
            document.getElementById('secAgenda').classList.add('d-none');
            document.getElementById('performanceSection').classList.remove('d-none');
            
            const chart = document.getElementById('performanceChart');
            chart.innerHTML = '';
            
            const subjects = [
                { name: 'Matematika', score: 85 },
                { name: 'Bahasa Indonesia', score: 90 },
                { name: 'Bahasa Inggris', score: 78 },
                { name: 'Fisika', score: 82 }
            ];
            
            subjects.forEach(s => {
                chart.innerHTML += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>${s.name}</span>
                            <span class="fw-bold">${s.score}</span>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-fill" style="width: ${s.score}%">
                                ${s.score}%
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        function startPractice() {
            Ui.showNotification('Mode latihan akan segera hadir!', 'info');
        }
        
        function showNotifications() {
            Swal.fire({
                title: 'Notifikasi',
                html: `
                    <div class="text-start">
                        <div class="alert alert-info mb-2">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Ujian Baru</strong><br>
                            <small>Ujian Matematika akan dimulai 1 jam lagi</small>
                        </div>
                        <div class="alert alert-success mb-2">
                            <i class="bi bi-trophy me-2"></i>
                            <strong>Selamat!</strong><br>
                            <small>Anda naik peringkat ke #40</small>
                        </div>
                        <div class="alert alert-warning mb-0">
                            <i class="bi bi-clock me-2"></i>
                            <strong>Pengingat</strong><br>
                            <small>Jangan lupa mengerjakan tugas Bahasa Indonesia</small>
                        </div>
                    </div>
                `,
                showConfirmButton: true,
                confirmButtonText: 'Tandai semua dibaca'
            });
        }
        
        function refreshAgenda() {
            Ui.showNotification('Memperbarui agenda...', 'info');
            setTimeout(() => {
                Dashboard.show();
                Ui.showNotification('Agenda diperbarui!', 'success');
            }, 1500);
        }
        
        // EXPORTS
        window.loadAgendaDropdown = Auth.loadAgendas; 
        window.downloadKartu = () => {
            html2canvas(document.getElementById('kartuArea')).then(c => { 
                const a=document.createElement('a'); 
                a.download='Kartu Peserta CBT PRO.png'; 
                a.href=c.toDataURL(); 
                a.click(); 
            });
        };
        window.tutupKartuKeLogin = () => { 
            bootstrap.Modal.getInstance(document.getElementById('modalKartu')).hide(); 
            document.querySelector('[data-bs-target="#tabLogin"]').click(); 
        };
        
        // Initialize
        window.onload = () => {
            Auth.init();
            
            // Load dark mode preference
            const darkMode = App.data.get('darkMode');
            if(darkMode) {
                document.body.classList.add('dark-mode');
                App.state.darkMode = true;
            }
            
            // Check for saved answers
            const savedAnswers = App.data.get('ans_1');
            if(savedAnswers) {
                App.state.jawaban = savedAnswers;
            }
        };
        
        // Prevent copy/paste
        document.addEventListener('copy', (e) => e.preventDefault());
        document.addEventListener('paste', (e) => e.preventDefault());
        document.addEventListener('cut', (e) => e.preventDefault());
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if(document.getElementById('viewUjian').classList.contains('d-none')) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    if(!e.target.matches('input, textarea')) {
                        e.preventDefault();
                        Exam.navSoal(-1);
                    }
                    break;
                case 'ArrowRight':
                    if(!e.target.matches('input, textarea')) {
                        e.preventDefault();
                        Exam.navSoal(1);
                    }
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                    if(!e.target.matches('input, textarea') && e.ctrlKey) {
                        e.preventDefault();
                        Exam.ansPGSingle(String.fromCharCode(64 + parseInt(e.key)));
                    }
                    break;
                case 'r':
                    if(!e.target.matches('input, textarea') && e.ctrlKey) {
                        e.preventDefault();
                        document.getElementById('checkRagu').click();
                    }
                    break;
                case 'b':
                    if(!e.target.matches('input, textarea') && e.ctrlKey) {
                        e.preventDefault();
                        bookmarkQuestion();
                    }
                    break;
            }
        });
    </script>
</body>
</html>
